<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Resultados da Corrida</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    .piloto { background: #fff; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 10px; }
    .vencedor { border: 2px solid #28a745; background: #e8f9ee; }
  </style>
</head>
<body>
  <h1>Classificação da Corrida</h1>
  <div id="resultados"></div>

  <script>
    const firebaseConfig = {
      databaseURL: "https://cronometregemgps-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref().on("value", snapshot => {
      const data = snapshot.val();
      const resultados = [];

      for (let chave in data) {
        const piloto = data[chave];
        resultados.push({
          nome: piloto.nome_piloto || 'Desconhecido',
          kart: piloto.numero_kart || '--',
          melhor: piloto.melhor_volta || '--:--',
          atual: piloto.tempo_atual || '--:--',
          voltas: piloto.voltas || 0
        });
      }

      // Ordena por voltas e melhor tempo
      resultados.sort((a, b) => {
        if (b.voltas !== a.voltas) return b.voltas - a.voltas;
        return a.melhor.localeCompare(b.melhor);
      });

      // Exibe na tela
      const container = document.getElementById("resultados");
      container.innerHTML = "";

      resultados.forEach((p, index) => {
        const div = document.createElement("div");
        div.className = "piloto" + (index === 0 ? " vencedor" : "");
        div.innerHTML = `
          <strong>${p.nome}</strong> (Kart ${p.kart})<br>
          Melhor volta: ${p.melhor}<br>
          Tempo atual: ${p.atual}<br>
          Voltas: ${p.voltas}
        `;
        container.appendChild(div);
      });
    });
  </script>
</body>
</html>